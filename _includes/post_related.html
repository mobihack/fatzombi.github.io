<div class="box">

<h4 class="title">You May Also Enjoy</h4>

<hr> 
  
{% assign maxRelated = site.related_posts_max %}
{% assign minCommonTags =  2 %}
{% assign maxRelatedCounter = 0 %}

{% for post in site.posts %}

    {% assign sameTagCount = 0 %}
    {% assign commonTags = '' %}

    {% for tag in post.tags %}
      {% if post.url != page.url %}
        {% if page.tags contains tag %}

          {% assign sameTagCount = sameTagCount | plus: 1 %}
          {% capture tagmarkup %} <span class="tag">{{ tag }}</span> {% endcapture %}
          {% assign commonTags = commonTags | append: tagmarkup %}
        {% endif %}
      {% endif %}
    {% endfor %}

    {% if sameTagCount >= minCommonTags %}
    <article class="media">
              <div class="media-left">
                <figure class="image is-64x64">
                  {% if post.image %}
                  <img src="{{ post.image[0].url }}" alt="{{ post.image[0].alt }}" title="{{ post.image[0].title }}" />

                  {% else %}
                  <canvas width="64" height="64" class="identicons" data-jdenticon-url="hashCode('{{ post.url |slugify }}')"></canvas>
                  {% endif %}
                </figure>
              </div>
              <div class="media-content">
                <div class="content">
                    <strong>@{{ post.author }}</strong> <small class="is-pulled-right">{{ post.date | date_to_string }}</small>
                    <br>
                    <h3><a href="{{ post.url }}" title="{{ post.title }}">{{ post.title }}</a></h3>
                </div>
                <nav class="level is-mobile">
                  <div class="level-left">
                  {% assign shareUrl=post.url | absolute_url | uri_escape %}
                    <a class="level-item" href="http://www.facebook.com/sharer.php?u={{ shareUrl }}" target="_blank">
              <span class="icon is-small"><i class="fa fa-facebook"></i></span></a>
                    <a class="level-item" href="http://twitter.com/share?url={{ shareUrl }}&text={{ post.title | uri_escape }}" target="_blank">
            <span class="icon is-small"><i class="fa fa-twitter"></i></span></a>
                  <a class="level-item" href="https://plusone.google.com/_/+1/confirm?hl=en&url={{ shareUrl }}" target="_blank">    
            <span class="icon is-small"><i class="fa fa-google-plus"></i></span></a>
                 </div>
                 <div class="level right">{{ commonTags }}</div>
                </nav>

              </div>
            </article>


      {% assign maxRelatedCounter = maxRelatedCounter | plus: 1 %}
      {% if maxRelatedCounter >= maxRelated %}
        {% break %}
      {% endif %}
    {% endif %}

  {% endfor %}
  {% if maxRelatedCounter < 1 %}
    <div class="message is-danger">
      <div class="message-body">
       <span class="icon"><i class="fa fa-warning"></i></span> We couldn't find a related post for this post.
      </div>
    </div>
  {% endif %}

</div>